<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_snc_complicatedw.SimpleWeather</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description>Stores weather parameters for city</description>
        <name>SimpleWeather</name>
        <script><![CDATA[var SimpleWeather = Class.create();
SimpleWeather.prototype = {
    initialize: function() {},
    insertSnapshot: function(sys_id, temperature, humidity) {
        var record = new GlideRecord('x_snc_complicatedw_weathersnapshot');
        record.initialize();
        record.city = sys_id;
        record.temperature = temperature;
        record.humidity = humidity;
        record.unit = "Farenheit";
        record.insert();
    },
    getWeather: function getWeather(glideRecordObject) {
        try {
            var r = new sn_ws.RESTMessageV2('x_snc_complicatedw.OWM', 'Default GET');
            r.setQueryParameter("id", glideRecordObject.city);
            var response = r.execute();
            var responseBody = response.getBody();
            responseBody = JSON.parse(responseBody);
            var humidity = responseBody.main.humidity;
            var temp = responseBody.main.temp;
            temp = this.convertKelvinToF(temp);
            var httpStatus = response.getStatusCode();
            this.insertSnapshot(glideRecordObject.sys_id, temp, humidity);
            // table endpoint   https://batman101.service-now.com/
        } catch (ex) {
            var message = ex.message;
        }
    },
    convertKelvinToF: function convertKelvinToF(temp) {
        temp = temp - 273.15;
        temp = temp * 9 / 5;
        temp = temp + 32;
        return Math.round(temp);
    },
    type: 'SimpleWeather'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>vladislav.bondarenko@snc</sys_created_by>
        <sys_created_on>2020-03-27 23:42:32</sys_created_on>
        <sys_id>49dfdff5dbb3001022d95ff25e961912</sys_id>
        <sys_mod_count>10</sys_mod_count>
        <sys_name>SimpleWeather</sys_name>
        <sys_package display_value="ComplicatedWeather" source="x_snc_complicatedw">f93d9b75dbb3001022d95ff25e9619bf</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="ComplicatedWeather">f93d9b75dbb3001022d95ff25e9619bf</sys_scope>
        <sys_update_name>sys_script_include_49dfdff5dbb3001022d95ff25e961912</sys_update_name>
        <sys_updated_by>vladislav.bondarenko@snc</sys_updated_by>
        <sys_updated_on>2020-03-31 19:42:02</sys_updated_on>
    </sys_script_include>
</record_update>
